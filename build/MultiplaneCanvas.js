var MultiplaneCanvas=function(b,c){function i(){f.clearRect(0,0,e.width,e.height),h.render()}function n(){requestAnimationFrame(n),l=performance.now(),(m=l-k)>j&&(h.setAxis(e.width,e.height),i(),k=l-m%j)}var d=c||24,e=b||document.querySelector("canvas"),f=e.getContext("2d"),g=new Camera(400,200),h=new Scene(e.width,e.height,g,f);e.addEventListener("mousemove",function(a){var b=.15*(-1*a.clientX+e.width/2),c=.15*(-1*a.clientY+e.height/2);g.adjust(b,c)}),window.onscroll=function(a){g.adjust(0,window.scrollY/5)};var l,m,j=1e3/d,k=performance.now();return n(),{scene:h,camera:g}},Scene=function(a,b,c,d){this.geo=[],this.camera=c,this.context=d,this.canvas=this.context.canvas,this.setAxis=function(a,b){this.axis=new Vector(a/2,b/2,0)},this.setAxis(a,b),this.render=function(){this.camera.update();for(var a of this.geo)if(a.visible){var b=this.axis.x+a.position.x+this.camera.position.x*a.position.z,c=this.axis.y+a.position.y+this.camera.position.y*a.position.z;switch(this.context.globalAlpha=a.alpha,a.constructor.name){case"ImagePlane":this.context.drawImage(a.image,b,c,a.width,a.height);break;default:this.context.fillStyle=a.color,this.context.fillRect(b,c,a.width,a.height)}}},this.add=function(a){this.geo.push(a)},this.loadFromJson=function(a){var b=a.objects;for(var c of b){var d=c.position,e=new ImagePlane(d.x,d.y,d.z,c.scale,c.image,c.alpha);this.add(e)}}},ImagePlane=function(a,b,c,d,e,f){this.visible=!1,this.color="green",this.alpha=f||1,this.image=new Image,this.image.src=e,this.image.onload=function(){this.scale=d,this.aspect_ratio=this.image.width/this.image.height,this.width=this.scale*c,this.height=this.scale*c/this.aspect_ratio,this.position={x:a-this.width/2,y:b-this.height/2,z:c},this.visible=!0}.bind(this)},Camera=function(a,b){this.position=new Vector(a||0,b||0,0),this.nextPosition=new Vector(0,0,0),this.lastPosition=new Vector(0,0,0),this.force=new Vector(0,0,0),this.updateCylce=0,this.update=function(){var a=this.nextPosition.x-this.lastPosition.x,b=this.nextPosition.y-this.lastPosition.y;this.position.x+=(a+this.force.x)/24,this.position.y+=(b+this.force.y)/24,this.updateCylce++},this.move=function(a,b,c){var a=a||0,b=b||0,d=new Vector(a,b,c);this.lastPosition=this.position,this.nextPosition=d},this.adjust=function(a,b,c){this.force.x=a,this.force.y=b,this.force.z=c}},Vector=function(a,b,c){this.x=a,this.y=b,this.z=c};