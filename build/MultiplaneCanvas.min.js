"use strict";function MultiplaneCanvas(a){function i(){d.clearRect(0,0,c.width,c.height),e.render()}function n(a){requestAnimationFrame(n),(m=a-k)>j&&(e.setAxis(c.width,c.height),i(),k=a-m%j)}var a=a||{},b=a.fps||60,c=a.canvas||document.querySelector("canvas"),d=c.getContext("2d");this.waitForAssets=a.waitForAssets||!0,this.scene=new MultiplaneCanvas.Scene(c.width,c.height,d,this.waitForAssets),this.reactOnScroll=a.reactOnScroll||!1,this.reactOnMouse=a.reactOnMouse||!1;var e=this.scene,f=this.scene.camera,g=function(a){if(this.reactOnMouse){var b=.15*-(a.clientX-c.clientWidth/2),d=.2*-(a.clientY-c.clientHeight/2);f.adjust(b,d)}};c.addEventListener("mousemove",g.bind(this));var h=function(a){this.reactOnScroll&&f.adjust(0,-window.scrollY/2)};window.addEventListener("scroll",h.bind(this));var m,j=1e3/b,k=performance.now();n()}MultiplaneCanvas.Scene=function(a,b,c,d){this.camera=new MultiplaneCanvas.Camera,this.context=c||{},this.canvas=this.context.canvas,this.cacheScene=d||!1,this.planes=[];var e;this.setAxis=function(a,b){e=new MultiplaneCanvas.Vector(a/2,b/2,0)},this.setAxis(a,b);var f=!1;this.render=function(){if(f||!this.cacheScene){for(var a=0;a<this.planes.length;a++){var b=this.planes[a];this.context.globalAlpha=b.alpha;var c=e.x+b.position.x+this.camera.getPosition().x*b.position.z,d=e.y+b.position.y+this.camera.getPosition().y*b.position.z;switch(b.type){case"ImagePlane":this.context.drawImage(b.image,c,d,b.width,b.height);break;default:this.context.fillStyle=b.color,this.context.fillRect(c,d,b.width,b.height)}}this.camera.update()}else this.isCached()},this.isCached=function(){for(var a=!1,b=0;b<this.planes.length;b++){if(!this.planes[b].cached)return!1}return f=!0,a},this.add=function(a){this.planes.push(a)},this.loadFromJson=function(a){var b=a.objects,c=a.camera;c&&this.camera.setPosition(c.x,c.y);for(var d=0;d<b.length;d++){var e=b[d],f=e.position,g=new MultiplaneCanvas.ImagePlane(f.x,f.y,f.z,e.scale,e.image,e.alpha);this.add(g)}}},MultiplaneCanvas.ImagePlane=function(a,b,c,d,e,f){this.type="ImagePlane",this.position=new MultiplaneCanvas.Vector(0,0,0),this.color="green",this.alpha=f||1,this.image=new Image,this.image.src=e,this.cached=!1,this.image.onload=function(){c/=100,this.scale=d;var e=this.image.width/this.image.height;this.width=this.scale*c,this.height=this.scale*c/e,this.position.x=a-this.width/2,this.position.y=b-this.height/2,this.position.z=c,this.cached=!0}.bind(this)},MultiplaneCanvas.Camera=function(a,b,c){var d=new MultiplaneCanvas.Vector(a||0,b||0,c||0),e=new MultiplaneCanvas.Vector(0,0,0),f=new MultiplaneCanvas.Vector(0,0,0),g=new MultiplaneCanvas.Vector(0,0,0);this.update=function(){var a=f.x-g.x,b=f.y-g.y;d.x+=(a+e.x)/24,d.y+=(b+e.y)/24},this.move=function(a,b,c){var a=a||0,b=b||0,e=new MultiplaneCanvas.Vector(a,b,c);g=d,f=e},this.adjust=function(a,b,c){e.x=a,e.y=b,e.z=c},this.getPosition=function(){return new MultiplaneCanvas.Vector(d.x,d.y)},this.setPosition=function(a,b){d.x=a,d.y=b}},MultiplaneCanvas.Vector=function(a,b,c){this.x=a,this.y=b,this.z=c};